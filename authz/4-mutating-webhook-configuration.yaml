apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  namespace: security
  name: webhook
webhooks:
  - name: webhook-service.security.svc
    failurePolicy: Fail
    objectSelector:
      # matchLabels:
      #   authz-injection: enabled
      matchExpressions:
        - {key: type, operator: NotIn, values: [front-end, data-base]}

    clientConfig:
      service:
        name: webhook-service
        namespace: security
        path: "/mutate"
      #this is base64 encode of rootCA.crt `cat rootCA.crt | base64 | tr -d '\n'`
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY0akNDQThxZ0F3SUJBZ0lKQUlWR3JRZU8vRkFiTUEwR0NTcUdTSWIzRFFFQkN3VUFNSUdGTVFzd0NRWUQKVlFRR0V3SkNVakVWTUJNR0ExVUVDQXdNVThPRHdxTnZJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4ZwpVR0YxYkc4Z01SWXdGQVlEVlFRS0RBMURiM0p3SUZObFkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoCmNuUnRaVzUwTVJjd0ZRWURWUVFEREE0cUxuTmxZM1Z5YVhSNUxuTjJZekFlRncweU1EQTNNamN5TXpFeE5UbGEKRncweU16QTFNVGN5TXpFeE5UbGFNSUdGTVFzd0NRWURWUVFHRXdKQ1VqRVZNQk1HQTFVRUNBd01VOE9Ed3FOdgpJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4Z1VHRjFiRzhnTVJZd0ZBWURWUVFLREExRGIzSndJRk5sClkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoY25SdFpXNTBNUmN3RlFZRFZRUUREQTRxTG5ObFkzVnkKYVhSNUxuTjJZekNDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFPQWQwdGZQaUtCRQp6cmlhM01aVkUvNzlNL1Qrbm1ablc3a3U3WFJlYytIQUhyeGZBbEx0WldyclpDYXUrcERyVG1zVGZIUHUvbWNRCmdSV1k4TTJmNUh2MWEvWXliSFRZMVR6R0krWEhIZlFoRlh0QVJSemM2cXZoY0Y2di9rTjB0ZTRxa3ZSVE9qRGQKMkxrcnZkUVVQUU50ckpRYlIxUi9JSHczcW5EdUhZbjNYdjRmL0ZrNnZZdFNYcmNwZGNOUXVDU2lDZjQrLzlEZwpVNi9lSE5ZUkRmQlBSM3ZrSk9Rd3d2MDhuWG5Sa2RNZ1hKdElpNVJLTHpFMmxWV3MzaExiekN4N3pwQytqVDhpCkxzeFcwWTZ3ZTFJNUowTklhaFZzSDA5RGgxVEFudkFwYXlQbnR4ZzNkREk5YWlPcXN4WUhTM3ROVFE2VkRMMnAKL1krSVEyd01Fc3FnNDZ1UzZJVXZFbnBSWUZCZjRtb3QySXJSVjhmUGN1emJPdTUwamFqNXZvekF5QlFnTmsvYwo4UFdXeWJSajkxUCs3d05XVklKQTNwbmVCQ3ZMSWs1N2ZQNWNtTkk4Vzh4SktIT09RK3B6cGNiVWV0MVlpNktSCkJ4RGtvamYyN1hvcGViM0VmemNDRGg1cUlpWU5xOU0xUmNPYjIyMVdVaHc4ZG1MU0U1aFFDT29nbDFwa0UwL0IKL0pWQmhUSDY0RkZzSENTcjdRTUVucWNXblR5SGFFc0JXU0JzdEpZSDBpelhZNy9zVi8ydlA2TnhkdGt2RWgwNAo3OU5TMkVHTDJnakpocXhFc3pucEhUdlBlNDNsL2lobExwdWE1RXd6NlZtN3c1ZEtrRDdIb05vbUkwajRZb2U1CmcxRlRpM0VHVURTcVNBQmRsREZaQVgrbGJTNmdMeUk3QWdNQkFBR2pVekJSTUIwR0ExVWREZ1FXQkJUTVQwaC8KMXE4d1RYMXlUampNOU5mcVp6Ym9OekFmQmdOVkhTTUVHREFXZ0JUTVQwaC8xcTh3VFgxeVRqak05TmZxWnpibwpOekFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUF3aW9FSlN6RWhkV2lVCmRDU2dmQlV4YmFOak40aFFEdnVRZVR3SHMxR0tYcmNIMFE2QWFKdVhqM0d2U2RCVVV4ajVZT3A5RVBNL3VKL2gKV3U2eGcwVFZDR0lMMWlBbGt1dWpBNUxKNFk1aXdMUDFEMFhuUFAzRUdlNzltSXUvR2RLWHZyMi93YkZDNjEzLwp0SjlEVDhhRlFSaUhVcHBhczdOVkFsSkJWazBTVFJnRFBBWndPK0dOZ1FTdENDQ0pubDdGSGc4MFZUS2U2Nys1CkY3aERoaExEOVlmSzhHZk1qd0xnOWt5ZlR1VUZjMjFOZlZFakQ4by90UURNb0kyMkNYaTB2UGhXb2RndVI5M0cKeDliNTh5TlZ6cm5MUk04THZ0a2xzQmpZcGlaRUdFSUV0RnJyTXpNRnM3OWlYZng4NWxpM1J2VmZ5RERScTladApQL2J1ZENZU3h2MVdlTDRoY1FFdm1OWVVERDZ5SFQzaTZrYjlWVU00ck5wMFk3L25rNk05eVdSanNzTnR2QnBTCmtxRnFXUE1oTEthRnJwWks4QjFmbGE1WThyTEQ1VEhsM0VVSkQxT3RyRTFJODBhWnhwN2lEemhzcGVabnI5VUcKakdSWmpDdStQTzBkV2ZrVDlYMVpVNG9vdmswcnFtMWhWb1pFcE5Ya1RlVDJ5LzFNVm1tZ21GMjBsRkZ5SlJ5Swp0UCtzeXB6L2RlamU1LzUwM2FpbU56S1pLV2d1S0dHSXFUbDhPaXJ4WGFrei91WVFuYXI5dXMxTFAwSjN4S2Y1Cks1OENxMUVtemY5RGd4b1grem5IUXkyUzhZc2ZUSDdpQTVaVmZwNDZRYit5dnlKZldzbWpEVlc0aHd4czhnUzkKZ0pOUTFJbGd5OUZ4dGFKWU1BY2t1S0gvejRWQW9BPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE" ]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    namespaceSelector:
      matchLabels:
        authz-injection: enabled
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  namespace: security
  name: webhook
webhooks:
  - name: webhook-service.security.svc
    failurePolicy: Fail
    objectSelector:
      # matchLabels:
      #   authz-injection: enabled
      matchExpressions:
        - {key: type, operator: NotIn, values: [front-end, data-base]}

    clientConfig:
      service:
        name: webhook-service
        namespace: security
        path: "/mutate"
      #this is base64 encode of rootCA.crt `cat rootCA.crt | base64 | tr -d '\n'`
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY0akNDQThxZ0F3SUJBZ0lKQU9QMy9vT0dEUUx3TUEwR0NTcUdTSWIzRFFFQkN3VUFNSUdGTVFzd0NRWUQKVlFRR0V3SkNVakVWTUJNR0ExVUVDQXdNVThPRHdxTnZJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4ZwpVR0YxYkc4Z01SWXdGQVlEVlFRS0RBMURiM0p3SUZObFkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoCmNuUnRaVzUwTVJjd0ZRWURWUVFEREE0cUxuTmxZM1Z5YVhSNUxuTjJZekFlRncweU1EQTJNamt4TkRReU1ESmEKRncweU16QTBNVGt4TkRReU1ESmFNSUdGTVFzd0NRWURWUVFHRXdKQ1VqRVZNQk1HQTFVRUNBd01VOE9Ed3FOdgpJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4Z1VHRjFiRzhnTVJZd0ZBWURWUVFLREExRGIzSndJRk5sClkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoY25SdFpXNTBNUmN3RlFZRFZRUUREQTRxTG5ObFkzVnkKYVhSNUxuTjJZekNDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFLajZRU2NPZkZYawpQY0VRWFd0Z0J6VnMrMGxmWmNmNmJIQlQ3TVV2UVN0cDIyYTR1ak1VNG1yaXRCZnVNc0ZZcHFSeHZ3RGxrVnN0CkdMeksyb2V6VzU3WVM4dENHcDFxWGFyLzBabjBIRW5Jc3dXdkhTZmwzZ0lsR011dWV4VTlyM0xocks4Sy90OWIKckVKWkpCQVI0RllFdTNERk52WkVkVTg2aGJDNWdpbG1tSzhxLy9FdElJd2s0L0htOUhqQUZiQjNDazhRWWpuVQp0WGR0RzJuZEtLbWpVeTk5Q0wyTDU4MHpwNUF6WUkyVVZGeWFWUFFxYkUxYWZWV256Y2Z2OTBuM2VPUXNxYldvCnNBTGNMOU1IWUtNajRhdTErQk1iVDA3Y2RuY2tDSGFoRVVaU29ZWHR4UDdDclZValErY3d2VW8zTWdJS2ZqZm8KaTc0aEZoMHNvMzF3cmQzTisxamUza3RhZGVoTU12WlJZeUR5dDBsMENqenRpb3AwRWYvT2YvaXk0dmtUTWpQeAoxV1NObEsrTzE3UEVpdkV1TVRBbTVZMDVxT3NqTGhSYmdhckhpRi9XY015QnBaYW1US1c3alNoQTlUdmJ0V3kxCkEySHZkeVVGRnZQSkFNSElGVjA5eDFqN0xCM2p2MWVYK2M4ak1yRHRrc1F1Vys0bllOdnYvOHB5YkFjdTdadGEKSGhqOWMwUUtwYjNlbm4xbFNJUm9OVmJObUw1UDZ3V0luMlc4bUxpaW4rOVB1WDlUSlFIZU12NlNJNGM1a04vKwpabUVucEU0MGxubnRJdFpMWVUrWUt5VUFIQ2FVdWlJS3IrVDB4WU8rb0ZlRG1Jc1FrWFFwTmNmTTNyRXNVa3NMCmVLRDFEWlg3VU5wcEtaemRSZlZ0QlpTc3BmMnIwZC9wQWdNQkFBR2pVekJSTUIwR0ExVWREZ1FXQkJUNVlFUysKT2h4cER1cjE1bUoxaE1NSGxzZlBVREFmQmdOVkhTTUVHREFXZ0JUNVlFUytPaHhwRHVyMTVtSjFoTU1IbHNmUApVREFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUIrbWc1bUViWHpTaXJjClJhT0pNSTc5YXVyRUNQQS9INzJQaVVLWkUxazVtdGU1U2d0aUNrVVpOZVpsK3NPN0lUZlRNcXhPd3dEUVhsRjkKdzB0RHZiZ1pDL2cwMzZIaXIzenRnOTJLM0Y4ZXI0bmprSWxRR2V4YnB4SXY1VllSN1JzdlNEYmplcWdGbm9MbQozcXFFWitUVnk1U1psTHI4S21BaE0zZmpQS1l5WHZuK3dxL0tqdzlyaGJ5MjFacjhwR3N2MjU1azlFTlloNkhuCldHYVdnbHE2VkFCb3FONE1FcHovWmdoVzRwUEtNVWJNUmV3NFZHR3dxREpxOGp1cVpmSnUvb0swRzNCaXlmcDkKRFhXZE9wOG54MWdPSDkzYTZWdXF5TDNGaVp4RzRFeERTSVhjd1d5UndZSnkwNmNZVmxSaFlSVjgvem5lN3kyeApUQWVhVTd1MTI0d2JmemV3N3JKUEZHeGNESE1zeEZwUldWQStpc0R3dnl2QytRS2xnWW4wRS9OM1lxa3RlK1dVCjRUdVhHbHJ0RHRqa0tVNFJRZnJ3UjVueXFWQUlYRjM1K2QwVThuNGoxNW5sc01KOW9qVURqbmQrblpQNENxb2gKMUZaTVdiZjJmV0huVGZweSs5VXhmY1Y0NmU2VHJkUnVVQW4rdnpmM0JSSE5yT0RlaG5NVEYyRnlGcGhweEY0MApLczZxQS9xZFVENlk4UnIvdk9FL3NtM0lPdWNhRjNaK1NrLzBYbVVWZnd3SzY2clN5bStaNXY0d0NUZVR2UUNlCnpJSUtTUnpTbEo3YTl2cXlCT05LN3J1ODdndUh6L01ac3ZpeUNTdDgyV2pHVGo2TmVjdXJMZlJRVFViVFpDaW0KZndiYTZLMk9KakI1N09nc1ZEQ0NMVXJLWnlJK2JRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE" ]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    namespaceSelector:
      matchLabels:
        authz-injection: enabled
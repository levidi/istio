apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  namespace: security
  name: webhook
webhooks:
  - name: webhook-service.security.svc
    failurePolicy: Fail
    objectSelector:
      # matchLabels:
      #   authz-injection: enabled
      matchExpressions:
        - {key: type, operator: NotIn, values: [front-end, data-base]}

    clientConfig:
      service:
        name: webhook-service
        namespace: security
        path: "/mutate"
      #this is base64 encode of rootCA.crt `cat rootCA.crt | base64 | tr -d '\n'`
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY0akNDQThxZ0F3SUJBZ0lKQUlXYm5HbktoSEFvTUEwR0NTcUdTSWIzRFFFQkN3VUFNSUdGTVFzd0NRWUQKVlFRR0V3SkNVakVWTUJNR0ExVUVDQXdNVThPRHdxTnZJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4ZwpVR0YxYkc4Z01SWXdGQVlEVlFRS0RBMURiM0p3SUZObFkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoCmNuUnRaVzUwTVJjd0ZRWURWUVFEREE0cUxuTmxZM1Z5YVhSNUxuTjJZekFlRncweU1EQTNNVFl4TlRBMk5EUmEKRncweU16QTFNRFl4TlRBMk5EUmFNSUdGTVFzd0NRWURWUVFHRXdKQ1VqRVZNQk1HQTFVRUNBd01VOE9Ed3FOdgpJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4Z1VHRjFiRzhnTVJZd0ZBWURWUVFLREExRGIzSndJRk5sClkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoY25SdFpXNTBNUmN3RlFZRFZRUUREQTRxTG5ObFkzVnkKYVhSNUxuTjJZekNDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFLVFRNYkMzOFdIcwo1c2ZObXg5UmV4dnFmd1dETnN3TTliNVhvWDQrZHZIK1d0WngwKzRvTGFoNTZUNmZYQ3dON3JoNm55Qk83OGpyCk1teDd5R2doK2pQOTJpZ3QyQ1JGQXRhaUZaNkdLZW1HMmVSY2R5ZHFiSzNwWXA1Zlo1Vll1TlpGREZFZ0czMDAKdEVBUlVlaXJWSG9KNGtEY3dGUjNoSWxYY0M3VGlnb1haakFlSGJWVzBKeEE0cTlvRE9YMFJBaU9KSjdHLzU2NApXTXN2czgvVlZ4T0RqcEEyMVhKZGhLWWxMcXlzWXB0dERVWEYxRHFzb2FvYitUM1ZlaEx1Qkp0bUtoWFRYYjdoCkVqWGJKN3ArWWlHdmhSWEpoMkhyeVJNNEUrRzM4SzJjaC9hcEYyMmo5T0FFcDdiTUJBclVKdzNLWnQ5NG04bmQKV0NsM2FpalFHWjkyNHhRNlh2Wk9TMGMzVGRGNldGOFJnMitiSmV1aDNVWURkU2JUVGZ1K3hLODlMMkFwNVFUSQpTemNiZXVUd25iaUowY0J3bEdGL2xESVBGYlFzbXQreE96NFRyS0l2VmxYVUttWDMxTDQzZWlnK256aXJ5WjNkClVMT0pXZzZqcFV4cGNKM1VMdkZvSm5qMXYwYXB5L3RLYmVScXk0ZGd0LzZXUGJsanRCQmR0UUhpaE9EMTJZVVcKV0lZMlNaN0dkdTJVdjRvb1EveGJianJMSzF6cGo3K01udU9HbTlPcjhYM2RHK0xqSDBraTNleUs3SUI3VWpITgpsa21RV0hBeXNFck1PclVMYmhBSjJ3VnVKVTJjeGtxaENNTTI0OHBHTFNqYVBuQkw5SVluMHZhaUs1K0VMK2I1ClJxUUJoOFVIV3FOczFwamhkVGpYQ25SM0VkdjRMWlU3QWdNQkFBR2pVekJSTUIwR0ExVWREZ1FXQkJTVGVBODYKUjNQeW5MSzA3QVcwUmhibEFZcGhKVEFmQmdOVkhTTUVHREFXZ0JTVGVBODZSM1B5bkxLMDdBVzBSaGJsQVlwaApKVEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJJckRQOHh6UHVjVjRnClJRaWRIR21LbmE1RjcxYWZ6ZlQ1NlRQV3ByQWkzcHhTeVgxSk1ZQzdLUzlsWHpFY3VpQ05DOVRBMEVueXBqMjcKbkJrbmhZM2lXbERaNmFmdW40aFRGM0JoSDIyc09heElrUUlLa1htYnBuNGpyOXFRbTc0WndiTlJlVDYvK0VrYQpTaitpN2YwRFVCcElUUjhLU3lZaks3akU1cGJlOENYWHNQVXliZ0pZbGlkcUlWSmExQkhCcE54SE4yb3FJQ0V3CnV2SWszMG9FMEhSZHYxSkpYTGdNOVQ3MWpTWUpoRzhpdEEzUHZZZXFPR1lIai83T1EvSjhQQjZtWlJraG1hK0EKWitaWEV5UXF5R2srOGJ2Q1VOVnY2dCtEMEFReCtzanh2NTI3QTBXV0IySWVtclFRWnBjSFB2a2t1NEhwNWU4MQpPa2dzOW53UmpJMGRHYW1DYzczNWdTeG1OTVlIOTFvb2NsTFRaV2lBUUJoT1ovdTJIQzIvOXJycWR0cndob0doCld2bmJ5SFlvTlc5U0xFbjNVWjl3NzU0QjdPYlA2T0pGQzNHVkJRU21YOVJjSFdWbE1CczRPMnZWUERpVm0wbXMKL2RSdlV6VDRxZy9vNFpFVDNaTFp0eGJSNlBZNFNTOVlNbER4WG0zZTIrMHB2ZXRyb0hoazk3Vm1aZzd3S2dOZAp4M0QzRm1BNTFZY05TdGovcEYvbFVoYmc5NFNTemdONm1VNTI5UGpBMHJ2S1MraVNkdTlyZ3ZzNEVaVnN0TVpBCnlOTzE0eEVxU1RQWUZ3U3YxNXlrSk04UllWTlE4QnUvQWVGb2NhaUloZEJTL3BDS1NwdlcreDVUSHZCMng5OXUKbWJNcW0rbXR5L0FOZzYyV0w1amswWjk4aWxTdDhBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE" ]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    namespaceSelector:
      matchLabels:
        authz-injection: enabled
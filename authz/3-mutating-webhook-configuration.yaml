apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  namespace: security
  name: webhook
webhooks:
  - name: webhook-service.security.svc
    failurePolicy: Fail
    objectSelector:
      # matchLabels:
      #   authz-injection: enabled
      matchExpressions:
        - {key: type, operator: NotIn, values: [front-end, data-base]}

    clientConfig:
      service:
        name: webhook-service
        namespace: security
        path: "/mutate"
      #this is base64 encode of rootCA.crt `cat rootCA.crt | base64 | tr -d '\n'`
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY0akNDQThxZ0F3SUJBZ0lKQVBaUXdKZkdVcFRTTUEwR0NTcUdTSWIzRFFFQkN3VUFNSUdGTVFzd0NRWUQKVlFRR0V3SkNVakVWTUJNR0ExVUVDQXdNVThPRHdxTnZJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4ZwpVR0YxYkc4Z01SWXdGQVlEVlFRS0RBMURiM0p3SUZObFkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoCmNuUnRaVzUwTVJjd0ZRWURWUVFEREE0cUxuTmxZM1Z5YVhSNUxuTjJZekFlRncweU1EQTJNakF3TkRJeE5ESmEKRncweU16QTBNVEF3TkRJeE5ESmFNSUdGTVFzd0NRWURWUVFHRXdKQ1VqRVZNQk1HQTFVRUNBd01VOE9Ed3FOdgpJRkJoZFd4dk1SWXdGQVlEVlFRSERBMVR3NFBDbzI4Z1VHRjFiRzhnTVJZd0ZBWURWUVFLREExRGIzSndJRk5sClkzVnlhWFI1TVJZd0ZBWURWUVFMREExSlZDQkVaWEJoY25SdFpXNTBNUmN3RlFZRFZRUUREQTRxTG5ObFkzVnkKYVhSNUxuTjJZekNDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFKeHc2QnR1cUJJeQozN1J5N0tCNWRiQWJpdzhFanVabmxPckwyQVRKZEhkZ0FBL0dNMUpCMUNQK2Q5ZHMyRHJCc2ZuYzBoTzNMS2xZCnFoVUF5Sk5JUTNFRHFxeFZxaDVFMG93WHphbmpQbVBlQlpVRGlDY1pYakhzV3pNdEVFaUU3TFhSWkdiQVFRZ1IKTklrM01iN3BRMXl6ZzFMOEtiakRDV0dNMGdpeGpSckVSbm03N3UvNEJpMUk3KzhLUjN4akhCNm03OVdnWGN2eApBSGQrNU1oSkJwWnJIcHFHd2g0akg5NUxNeVJVNXVUMnBhQWdzTGJubEZjNG9GY0Z1b3gweDZERDh2Mnd6Y1B0CmhQbFFFelEvYW1sTWVPelliMHBqY1hEZWZCaWU5THNhN3VwektBUjVZa1BralBFU0pUT2NLcXVLYjJzRU5QVWkKYTdWQnR1RWt4bnB3OTcrdSthNk9jdFY5MjM2UzBJN3lIM2l1Q3lQNU5RUTlOSGs5TjZqSW52VTRpbWxPdlhjRgpYZ09VSEg4ZEExc1FXY1d5NTBXeGpFNXRQazZvT1dPa3o3V0VHdGJkLzBJNU9QMHNtYU1vQkdSV1RKb3QzNkllCkwrVDFLbVlhYmxLOG5MOVRpTXhnV21sRHdZblFOcHhlN09HU21nSHZkTERvQ3RwQUYzZzZ1K1M5Q0VvMFFMQnYKMGhxckhzL25jbFZkcDl2cU1oc0FDVGtJSmZodDRmMWJ6Y0JLN1c2UU8za2R3M3lhS1BPQVRiUkQyZ1hYaXNNWQpUTnZBT0hrdXZqZThuMHdpWE9VbU9OWkdhU3BiVzFVL25RV0dvMXBqVStmZllzdzh5eTkwVjUzb0p6anBvb3hWCkRQWFpsWk9xcklWYXFROEdoU0dwd2MvVVpHSlZraFRuQWdNQkFBR2pVekJSTUIwR0ExVWREZ1FXQkJRUm1JemIKL3BhK1RPb0s2RmVscUw5N1FrWUdSVEFmQmdOVkhTTUVHREFXZ0JRUm1JemIvcGErVE9vSzZGZWxxTDk3UWtZRwpSVEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJrVDdJZlZWaWNDZm9VCnZObDRjTSsyYm5mKzQ2Nm9GbDFqSFFFbFBhbkxFQUF0dkdDTkc4bVczVHp6M2xITUdFU0hUd3lTK0NyUXQ3TysKT08valB4azdSMTRkNTV2N0JpbXB5RUx3Z0FLd1NwclNYQ1BZaVlEOWl6enhEY09Sd0U4SzI0RzdVVlF5c1BJWApneTdHNEIzaGNaSXZ1NjhjU3J0VDcrWVVDc0srVFR6TEg2WnpzTVZjckM1YUhRVmo4VVZ3OW80U0x0QXFWMlRZCitRUUN2UDJGODVsM09Scm1VVnFkTmlZWEpjblIyV1ErOS9CdWNPdXRES0trc3dXajNOR2RRbzZTbytsR3E1TWEKbnU5MnZBZ2Z3bXdOWEVUdk1vaTVHdndjNmIvaGh0UjZ2blJ4VFlaVWRHdTJMUWhtYnlEYkZ0ZE9UUnNHR0Y2NgpuaS92MjBVVUh1S0ZUb293Q1Z0UXYyUENJWk5XMHBRYkJGRTJwQy9mQlV5NDBOYkNPRktzZnJLQTBNeHlpa0d0CnBkbXFkeGhOUEt4NktsaDNBOUJPeURneFdWTXdwT0lHTUg2UUdaeS9ZcDhhczlSdmdENjYxNHQrdURVMHZnUjIKcGhlYXhtL3lrWHFSdjdVNFhDWDFvekorY3NxQ0JUYy9POUJxZ1NWZkp0ZlFBNUZ1TnRvMmlwaFFvWEpDYlp1UQplNUdBQUsvck04cE9IVjNHSDE5ZG9lbllicTNHMGJjcXprajlPRFlrS1ZqZVc4QUlMVmxvUW5EWGRDNXZWL1ZHClF4UmkxaVQxQU1HdGdHQk9FdHhYNkMrTTRCZll1ZWVJVDFIM3N6RHF6YkZPbTY2cWtDcmY5a0kzeVE4YWNRNkYKYm56UHU5VGZqSTQ2dlVNTW5JK1RvVlo5TlFXWWFRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
    rules:
      - operations: [ "CREATE" ]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    namespaceSelector:
      matchLabels:
        authz-injection: enabled